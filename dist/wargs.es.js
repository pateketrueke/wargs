const r=/$|[!-@\[-`{-~].*/g,e=[];function t(r,e,t,a,n){var i=r[e],o=a[e],f=void 0!==o;if((f||void 0===n||!1!==n(e))&&(void 0===i?r[e]=t:Array.isArray(i)?i.push(t):r[e]=[i,t],f))for(var s=0,c=o.length;s<c;)r[o[s++]]=r[e]}var a=function(a,n){for(var i=(n=n||{}).unknown,o=function(r){var e,t={};for(var a in r)for(var n=t[a]=(e=r[a],Array.isArray(e)?e:[e]),i=0,o=n.length;i<o;i++)for(var f=t[n[i]]=[a],s=0;s<o;s++)i!==s&&f.push(n[s]);return t}(n.alias),f=function(r,t){var a={};for(var n in t){var i=t[n],o=r[n];if(void 0===a[n])if(a[n]=i,void 0===o)r[n]=e;else for(var f=0,s=o.length;f<s;f++)a[o[f]]=i}return a}(o,n.default),s=function(r,t){var a={};if(void 0!==t)for(var n=0,i=t.length;n<i;n++){var o=t[n],f=r[o];if(a[o]=!0,void 0===f)r[o]=e;else for(var s=0,c=f.length;s<c;s++)a[f[s]]=!0}return a}(o,n.boolean),c={_:[]},l=0,u=0,d=a.length,p=c._;l<d;l++){var v=a[l];if("--"===v)for(;++l<d;)p.push(a[l]);else if("-"===v||"-"!==v[0])p.push(v);else if("-"===v[1]){if(0<=(g=v.indexOf("=",2)))t(c,v.slice(2,g),v.slice(g+1),o,i);else if("n"===v[2]&&"o"===v[3]&&"-"===v[4])t(c,v.slice(5),!1,o,i);else t(c,A=v.slice(2),d===(u=l+1)||"-"===a[u][0]||void 0!==s[A]||a[l=u],o,i)}else{r.lastIndex=2;var h=r.exec(v),g=h.index,y=h[0]||d===(u=l+1)||"-"===a[u][0]||void 0!==s[v[g-1]]||a[l=u];for(u=1;u<g;)t(c,v[u],++u!==g||y,o,i)}}for(var A in f)void 0===c[A]&&(c[A]=f[A]);return c};const n=r=>`__Symbol@@${r}__`,i=n("QUOTE"),o=n("APOS"),f=n("SPA"),s=/-(\w)/g,c=/^((?!\d)[-~+.\w]+)([=:])(.+?)?$/,l=/(["'])(?:(?!\1).)*\1/,u=['"',"'"," "],d=[/\\"/g,/\\'/g,/\\ /g],p=[i,o,f],v=[i,o,f].map(r=>new RegExp(r,"g"));function h(r){return v.reduce((r,e,t)=>r.replace(e,u[t]),r)}function g(r,e){for(;l.test(r);){const e=r.match(l),t=e[0].substr(1,e[0].length-2);r=r.replace(e[0],u.reduce((r,e,t)=>r.replace(e,p[t]),t))}if(e)for(;r.indexOf(" ")>-1;)r=u.reduce((r,e,t)=>r.replace(e,p[t]),r);return r.split(/\s+/)}function y(r,e){if("function"==typeof e){if("object"!=typeof r)return e(r);Object.keys(r).forEach(t=>{r[t]=e(r[t],t)})}return r}export default(r,e,t)=>{if("function"==typeof(e=e||{})&&(t=e,e={}),e.format&&(t=e.format||t,delete e.format),!Array.isArray(r)){let e;r=function(r){return d.reduce((r,e,t)=>r.replace(e,p[t]),r)}(String(r||""));do{(e=r.match(l))&&(r=r.replace(e[0],g(e[0],!0)))}while(e);r=r.trim().split(/\s+/).map(h).filter(r=>r)}const n=r.indexOf("--"),i=[];n>-1&&(r.slice(n+1).forEach(r=>{i.push(y(r,t))}),r.splice(n+1,r.length));const o=a(r,e),f=o._.slice(),u={},v={};return delete o._,Object.keys(o).forEach(r=>{const a=o[r];-1!==r.indexOf("-")&&(delete o[r],r=function(r){return r.replace(s,(r,e)=>e.toUpperCase())}(r)),e.alias&&e.alias[r]&&0===e.alias[r].indexOf("no-")&&(o[e.alias[r].substr(3)]=!a,o[r]=!a),Array.isArray(a)&&(o[r]=a.map(r=>y(r,t))),"string"==typeof a&&("="===a.charAt()?o[r]=y(a.substr(1),t):o[r]=y(a,t))}),{_:f.reduce((r,e)=>{const a=e.match(c);return a?"="===a[2]?u[a[1]]=y(a[3]||"",t):v[a[1]]?(Array.isArray(v[a[1]])||(v[a[1]]=[v[a[1]]]),v[a[1]].push(y(a[3]||"",t))):v[a[1]]=y(a[3]||"",t):r.push(y(e,t)),r},[]),raw:i,data:u,flags:o,params:v}};
